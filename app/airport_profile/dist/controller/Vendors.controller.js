sap.ui.define(["./BaseController","sap/ui/core/routing/History","sap/f/LayoutType","sap/ui/model/json/JSONModel","../utils/formatters","sap/ui/Device"],function(t,e,r,o,a,s){"use strict";return t.extend("airportprofile.controller.Vendors",{formatter:a,onInit:function(){var t=new o({airportId:""});this.setModel(t,"vendorsView");this.getRouter().getRoute("Vendors").attachPatternMatched(this._onObjectMatched,this);this.getRouter().getRoute("Charges").attachPatternMatched(this._onObjectMatched,this);var e=new o({vendorContracts:[]});this.setModel(e,"vendorContracts")},_onObjectMatched:function(t){var e=t.getParameter("name");var o=t.getParameter("arguments");var a=t.getParameter("arguments").id;this.getModel("appView").setProperty("/currentAirportId",a);if(e==="Vendors"){this.getModel("appView").setProperty("/layout",r.OneColumn);this.getModel("appView").setProperty("/mainTabsVisible",true);this.getModel("vendorsView").setProperty("/airportId",o.id);this.loadData(o.id)}else if(e==="Charges"){if(!this.dataLoaded){this.loadData(o.id,o.vid)}else{this._setSelectedListItem(o.vid)}}},navToAirports:function(){this.getRouter().navTo("Airports",{},true)},onNavBack:function(){var t=e.getInstance().getPreviousHash();if(t!==undefined){history.go(-1)}else{this.navToAirports()}},_setSelectedListItem:function(t){var e=this.getModel("vendorContracts");var r=e.getProperty("/vendorContracts");r.forEach(e=>{e.contracts.forEach(e=>{e.selected=e.ID===t})});e.refresh()},loadData:function(t,e){var r=this.getModel("vendorContracts");var o=this;const a=this.getModel().sServiceUrl+"PurDocs";$.get({url:a,data:{$filter:`airport_ID eq '${t}'`},success:function(t){o.dataLoaded=true;var a=[];t.value.forEach(function(t){t.selected=t.ID===e;var r=a.find(e=>e.vendor_ID===t.vendor_ID);if(r){r.contracts.push(t)}else{a.push({vendor_ID:t.vendor_ID,contracts:[t]})}});r.setProperty("/vendorContracts",a)}})},onContractItemClicked:function(t){var e=t.getParameter("listItem");var r=e.getBindingContextPath();var o=this.getModel("vendorContracts").getProperty(r).ID;this._setSelectedListItem(o);var a=this.getModel("vendorsView").getProperty("/airportId");var i=!s.system.phone;this.getRouter().navTo("Charges",{id:a,vid:o},false)}})});