sap.ui.define(["./BaseController","sap/ui/core/routing/History","sap/f/LayoutType","sap/ui/model/json/JSONModel","../utils/formatters","sap/ui/Device"],function(t,e,r,o,s,a){"use strict";return t.extend("airportprofile.controller.Vendors",{formatter:s,onInit:function(){var t=new o({airportId:""});this.setModel(t,"vendorsView");this.getRouter().getRoute("Vendors").attachPatternMatched(this._onObjectMatched,this);var e=new o({vendorContracts:[]});this.setModel(e,"vendorContracts");this.getEventBus().subscribe("route","charges",this._onItemChanged,this)},_onItemChanged:function(t,e,r){if(!this.dataLoaded){if(!this.getModel("vendorsView").getProperty("/airportId")){this.getModel("vendorsView").setProperty("/airportId",r.id)}this.loadData(r.id,r.vid)}else{this._setSelectedListItem(r.vid)}},navToAirports:function(){this.getRouter().navTo("Airports",{},true)},_onObjectMatched:function(t){this.getModel("appView").setProperty("/layout",r.OneColumn);var e=t.getParameter("arguments").id;this.getModel("vendorsView").setProperty("/airportId",e);this.loadData(e)},onNavBack:function(){var t=e.getInstance().getPreviousHash();if(t!==undefined){history.go(-1)}else{this.navToAirports()}},_setSelectedListItem:function(t){var e=this.getModel("vendorContracts");var r=e.getProperty("/vendorContracts");r.forEach(e=>{e.contracts.forEach(e=>{e.selected=e.ID===t})});e.refresh()},loadData:function(t,e){var r=this.getModel("vendorContracts");var o=this;const s=this.getModel().sServiceUrl+"PurHeader";$.get({url:s,data:{$filter:`airport_ID eq '${t}'`},success:function(t){o.dataLoaded=true;var s=[];t.value.forEach(function(t){t.selected=t.ID===e;var r=s.find(e=>e.vendor_ID===t.vendor_ID);if(r){r.contracts.push(t)}else{s.push({vendor_ID:t.vendor_ID,contracts:[t]})}});r.setProperty("/vendorContracts",s)}})},onContractItemClicked:function(t){var e=t.getParameter("listItem");var r=e.getBindingContextPath();var o=this.getModel("vendorContracts").getProperty(r).ID;this._setSelectedListItem(o);var s=this.getModel("vendorsView").getProperty("/airportId");var i=!a.system.phone;this.getRouter().navTo("Charges",{id:s,vid:o},false)}})});