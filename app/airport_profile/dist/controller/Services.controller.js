sap.ui.define(["./BaseController","sap/f/LayoutType","sap/ui/model/json/JSONModel","../utils/formatters"],function(e,t,r,a){"use strict";return e.extend("airportprofile.controller.Services",{formatter:a,onInit:function(){var e=new r({busy:false,title:"",services:[],activeServicesIds:[]});this.setModel(e,"servicesDataModel");this.getRouter().getRoute("Services").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){this.getModel("appView").setProperty("/mainTabsVisible",true);this.getModel("appView").setProperty("/layout",t.TwoColumnsBeginExpanded);this.routeParams=e.getParameter("arguments");this._loadData(this.routeParams.uid,this.routeParams.itemid,this.routeParams.tid)},_getDataModel:function(){return this.getModel("servicesDataModel")},_loadData:function(e,t,r){var a=[];const s=`${this.getModel().sServiceUrl}TaskListItems`;a.push();const o=`${this.getModel().sServiceUrl}PurDocs`;var i=this._getDataModel();i.setProperty("/busy",true);var n=$.get({url:`${o}(ID=${e},IsActiveEntity=true)/items`,data:{$select:"description,status_code,serviceNumber_ID",$expand:"status"}});var u=$.get({url:`${s}(up__ID=${r},ID='${t}',IsActiveEntity=true)/purItem`});a.push(n);a.push(u);i.setProperty("/busy",true);Promise.all(a).then(function([e,t]){var r=t.value;var a=e.value;r.forEach(function(e){var t=a.find(t=>t.ID===e.purItem_ID);if(t){t.isActive=true}});i.setProperty("/services",a)}).finally(function(){i.setProperty("/busy",false)})},_mapDataToModel(e){var t=this._getDataModel();var r=e.map(function(e){e.effectiveDate=`${moment(e.validFrom).format("MMM Do YY")} - ${moment(e.validTo).format("MMM Do YY")}`;return e});var a=r.filter(function(e){return e.lineOfBusiness==="airport"});var s=r.filter(function(e){return e.lineOfBusiness==="cargo"});t.setProperty("/airportCharges",a);t.setProperty("/cargoCharges",s)},_displayItemsBySelectedTabKey:function(){var e=this._getDataModel();var t=this.getModel("taskDetailsViewModel").getProperty("/selectedTabKey");switch(t){case"airportCharges":e.setProperty("/items",e.getProperty("/airportCharges"));break;case"cargoCharges":e.setProperty("/items",e.getProperty("/cargoCharges"));break}},onLobTabSelected:function(){this._displayItemsBySelectedTabKey()},onBrfButtonPressed:function(e){var t=e.getSource().getParent();var r=t.getBindingContextPath();var a=this.getModel("detailsModel").getProperty(r)},onServicesButtonPressed:function(e){var t=e.getSource().getParent().getBindingContextPath();var r=this._getDataModel().getProperty(t)}})});