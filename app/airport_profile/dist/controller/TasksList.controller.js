sap.ui.define(["./BaseController","sap/f/LayoutType","sap/ui/Device","sap/ui/model/json/JSONModel"],function(e,t,a,i){"use strict";return e.extend("airportprofile.controller.TasksList",{onInit:function(){var e=new i({items:[]});this.setModel(e,"tasksListDataModel");this.getRouter().getRoute("TasksList").attachPatternMatched(this._onObjectMatched,this);this.getRouter().getRoute("TaskDetails").attachPatternMatched(this._onObjectMatched,this)},onExit:function(){},_getDataModel:function(){return this.getModel("tasksListDataModel")},_onObjectMatched:function(e){var a=e.getParameter("name");var i=e.getParameter("arguments");this.getModel("appView").setProperty("/mainTabsVisible",true);this.getModel("appView").setProperty("/currentSelectedTabKey",i.type);this.getModel("appView").setProperty("/currentAirportId",i.id);if(a==="TasksList"){this.getModel("appView").setProperty("/layout",t.OneColumn);this.getModel("appView").setProperty("/mainTabsVisible",true);this.getModel("appView").setProperty("/currentSelectedTabKey",i.type);this.loadData(i.type,i.id)}else if(a==="TaskDetails"){if(!this.dataLoaded){this.loadData(i.type,i.id,i.vid)}else{this._setSelectedListItem(i.vid)}}},loadData:function(e,t,a){var i=this.getModel().sServiceUrl+"TaskLists";var r=this._getDataModel();this.showBusyIndicator(true);var s=this;var o="";if(e==="dep"){o=`origin_ID eq '${t}'`}else if(e==="arr"){o=`destination_ID eq '${t}'`}$.get({url:i,data:{$filter:o,$orderby:"validTo desc","sap-valid-from":"date'1900-01-01'"},success:function(i){s.dataLoaded=true;s.showBusyIndicator(false);var o=_.cloneDeep(i.value);o.forEach(function(e){e.version=`${moment(e.validFrom).format("MMM Do YY")} - ${moment(e.validTo).format("MMM Do YY")}`;e.selected=e.ID===a;e.isCurrent=moment().isBetween(e.validFrom,e.validTo)});r.setProperty("/items",o);if(e!=="vendor"){var n=o.find(function(e){return e.isCurrent});if(n){s.getRouter().navTo("TaskDetails",{id:t,vid:n.ID,type:e},false)}}},error:function(e){s.showBusyIndicator(false)}})},_setSelectedListItem:function(e){var t=this._getDataModel();var a=t.getProperty("/items");a.forEach(t=>{t.selected=t.ID===e});t.refresh()},onTaskListPressed:function(e){var t=e.getParameter("listItem");var a=t.getBindingContextPath();var i=this._getDataModel().getProperty(a).ID;this._setSelectedListItem(i);var r=this.getModel("appView").getProperty("/currentAirportId");var s=this.getModel("appView").getProperty("/currentSelectedTabKey");this.getRouter().navTo("TaskDetails",{id:r,vid:i,type:s},false)},onAddAirport:function(){this.crossNavigate("airports_configuration","manage_airports")}})});